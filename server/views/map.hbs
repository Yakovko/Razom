<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Карта Проблем</title>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
</head>
<body>
<h2>some fucking stuff</h2>
<div id="map_canvas" style="height: 500px;"></div>
<script type="text/javascript">

    function initialize() {
        navigator.geolocation.getCurrentPosition(function(position) {
            console.log(position);
            alert(position.coords.longitude + " : " + position.coords.latitude);
            var myLatlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            var myOptions = {
                zoom: 8,
                center: myLatlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

            $.get("api/issues?lon=" + position.coords.longitude + "&lat=" + position.coords.latitude + "&radius=" + 500, function(data) {
               for(var i = 0; i < data.issues.length; i++) {
                   var issue = data.issues[i];

                   new google.maps.Marker({
                       position: new google.maps.LatLng(issue.lat, issue.lon),
                       map: map,
                       title: issue.title
                   });
               }
            });
        });



    }

    initialize();
</script>
</body>
</html>
